<% provide(:title, '利用者一覧') %>
<h1>利用者一覧</h1>

<% if @count.present? %>
  <p><%= "更新された利用者が#{@count.count}人います。再度確認をお願いします"%></p>
<% end %>

<div class="search">
  <%= search_form_for @q, url: search_care_users_path do |f| %>
    <%= f.search_field :name_or_department_cont, class: "form-control",placeholder: "name" %><br>
    <div class="search1">
      <%= f.radio_button :department_cont, '本店' %>本店
      <%= f.radio_button :department_cont, '上高畑' %>上高畑
      <%= f.submit 'search'%>
    </div>
  <% end %>
</div>
<div class="col-md-10 col-md-offset-1">
  <table class="table table-sm table-hover" id="table-care_users">
    <thead>
      <tr>
        <th></th>
        <th>name</th>
        <th>grade</th>
        <th>department</th>
        <th>confirmation</th>
      </tr>
    </thead>
    <% @care_users.each do |care_user| %>
      <tr>
        <td>
          <% if care_user.image? %>
            <img src='<%= care_user.image %>' class="index_icon" alt="ユーザーアイコン">
          <% else %>      
            <%= image_tag src='picture-3651039_1920.png', class: "index_icon", alt: "ユーザーアイコン" %>
          <% end %>   
        </td>
        <td><%= link_to care_user.name, care_user %></td>
        <td><%= care_user.grade %></td>
        <td><%= care_user.department %></td>
        <td>
        <div class="index_btn">
          <%= form_with(model: Intermediate, url: user_intermediates_path(current_user), local: true) do |form| %>
            <%= hidden_field_tag :user_id, current_user.id %>
            <%= hidden_field_tag :care_user_id, care_user.id %>
            <%= hidden_field_tag :confirmation, true %>
            <%= hidden_field_tag :indication, "" %>
            <% if Intermediate.exists?(user_id: current_user,care_user_id: care_user.id,confirmation: true) %>
              <%= form.submit "確認済", disabled: true,class: "btn btn-default " %>
            <% else %>
              <%= form.submit "確認", class: "btn btn-primary " %>
            <% end %>
          <% end %>
        </div>
        </td>
        <td>
          <% if current_user.admin?%>
            <div class="index_btn">
              <%= link_to  "編集", edit_care_user_path(care_user), class: "btn btn-sm btn-primary" %>
              <%= link_to "削除", care_user, method: :delete,data: { confirm: "削除してよろしいですか？" },class: "btn btn-sm btn-danger" %>
            </div>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>
  <%= paginate (@care_users) %>
</div>